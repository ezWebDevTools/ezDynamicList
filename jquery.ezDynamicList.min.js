(function(b){b.fn.ezDynamicList=function(a){function c(c){for(var d in a.arrRequiredToAction)if("undefined"===typeof b(c).parents(a.rowWrapTag).find(d).val()||""==b(c).parents(a.rowWrapTag).find(d).val())return!1;return!0}function c(c){for(var d in a.arrRequiredToAction)if("undefined"===typeof b(c).parents(a.rowWrapTag).find(d).val()||""==b(c).parents(a.rowWrapTag).find(d).val())return!1;return!0}function f(c){var d=b(a.initElement).find(a.selectorWrapDefaultLI);if(b(a.initElement).find(a.selectorParentUL+ " "+a.rowWrapTag).size()<a.intMaxRows)if(!0===c&&!0===a.boolAddCurrentClone){c=b(a.initElement).find(a.selectorParentUL+" "+a.rowWrapTag+":last").find("select");cloneLI=b(a.initElement).find(a.selectorParentUL+" "+a.rowWrapTag+":last").clone(!0);b(a.initElement).find(a.selectorParentUL).append(cloneLI).hide().fadeIn(a.speedFadeInLI);cacheNewLast=b(a.initElement).find(a.selectorParentUL+" "+a.rowWrapTag+":last");b(c).each(function(a){cacheNewLast.find("select").eq(a).val(b(this).val())});for(var e in a.arrAddCurrentReset)cacheNewLast.find(e).val("")}else d.show(), cloneLI=d.find(a.rowWrapTag).clone(!0),d.hide(),b(a.initElement).find(a.selectorParentUL).append(cloneLI).hide().fadeIn(a.speedFadeInLI);return d}function e(){a.cbRefreshPre&&a.cbRefreshPre(b(this),a);cacheRowWrapTag=b(a.initElement).find(a.selectorParentUL+" "+a.rowWrapTag);cacheRowWrapTagLast=b(a.initElement).find(a.selectorParentUL+" "+a.rowWrapTag+":last");cacheRowWrapTagNotLast=b(a.initElement).find(a.selectorParentUL+" "+a.rowWrapTag+":not(:last)");cacheRowWrapTag.size()==a.intMinRows?(cacheRowWrapTag.find(a.selectorEditClass).hide(), cacheRowWrapTag.find(a.selectorRemoveClass).hide(),cacheRowWrapTag.find(a.selectorAddClass).fadeIn(a.speedFadeInLI)):(cacheRowWrapTagNotLast.find(a.selectorAddClass).hide(),cacheRowWrapTagNotLast.find(a.selectorRemoveClass).hide(),cacheRowWrapTagNotLast.find(a.selectorEditClass).fadeIn(a.speedFadeInLI),cacheRowWrapTagLast.find(a.selectorEditClass).hide(),cacheRowWrapTagLast.find(a.selectorRemoveClass).fadeIn(a.speedFadeInLI),cacheRowWrapTagNotLast.find(":input").attr("disabled",!0));b(a.initElement).find(a.selectorParentUL+ " "+a.rowWrapTag).size()>=a.intMaxRows?(b(a.initElement).find(a.selectorParentUL+" "+a.rowWrapTag+":last "+a.selectorAddClass).hide(),b(a.initElement).find(a.selectorMaxRowsClass).show(),b(a.initElement).find(a.selectorMaxRowsClass).addClass(a.classMessageMaxRowsAlert)):(b(a.initElement).find(a.selectorParentUL+" "+a.rowWrapTag+":last "+a.selectorAddClass).fadeIn(a.speedFadeInLI),b(a.initElement).find(a.selectorMaxRowsClass).removeClass(a.classMessageMaxRowsAlert),!1==a.boolMessageMaxRowsDefault&& b(a.initElement).find(a.selectorMaxRowsClass).fadeOut(a.speedFadeOutLI));b(a.initElement).find(a.selectorParentUL+" "+a.rowWrapTag+":last :input").removeAttr("disabled");a.currentIndex=b(a.initElement).find(a.selectorParentUL+" "+a.rowWrapTag+":last").index();a.cbRefreshPost&&a.cbRefreshPost(b(this),a);return cacheRowWrapTagLast}a=b.extend({},b.fn.ezDynamicList.defaults,a);a.initElement=b(this);b(a.initElement).find(a.selectorWrapDefaultLI).hide();!1==a.boolMessageMaxRowsDefault&&b(a.initElement).find(a.selectorMaxRowsClass).hide(); b(a.initElement).find(a.selectorParentUL+" :input").attr("disabled",!0);!0===a.boolAutoAddOnLoad&&f();cacheLastLI=e();b(a.initElement).find(a.selectorAddClass).on("click",function(){if(!(b(a.initElement).find(a.selectorParentUL+" "+a.rowWrapTag).size()>=a.intMaxRows)){a.cbAddPre&&a.cbAddPre(b(this),a);if(!0!=c(this))return!1;boolClick=!0;cacheDefaultLI=f(boolClick);cacheLastLI=e();a.cbAddPost&&a.cbAddPost(b(this),a);return!1}});b(a.initElement).find(a.selectorEditClass).on("click",function(){if(b(this).parents(a.rowWrapTag).index()!= a.currentIndex&&!0!=c(b(this).parents("ul").find("li").eq(a.currentIndex).find(a.selectorEditClass)))return!1;a.cbEditPre&&a.cbEditPre(b(this),a);a.currentIndex=b(this).parents(a.rowWrapTag).index();cacheRowWrapTag=b(a.initElement).find(a.selectorParentUL+" "+a.rowWrapTag);cacheRowWrapTag.find(":input").attr("disabled",!0);cacheRowWrapTag.find(a.selectorEditClass).show();cacheRowWrapTag.find(a.selectorAddClass).hide();cacheRowWrapTag.find(a.selectorRemoveClass).hide();thisParentsRowWrapTag=b(this).parents(a.rowWrapTag); thisParentsRowWrapTag.find(":input").removeAttr("disabled");thisParentsRowWrapTag.find(a.selectorEditClass).show();thisParentsRowWrapTag.find(a.selectorRemoveClass).show();thisParentsRowWrapTag.is(cacheRowWrapTag.last())&&(thisParentsRowWrapTag.find(a.selectorEditClass).hide(),cacheRowWrapTag.size()==a.intMaxRows?thisParentsRowWrapTag.find(a.selectorRemoveClass).show():thisParentsRowWrapTag.find(a.selectorAddClass).show());a.cbEditPost&&a.cbEditPost(b(this),a);return!1});b(a.initElement).find(a.selectorRemoveClass).on("click", function(){a.cbRemovePre&&a.cbRemovePre(b(this),a);!0!==a.boolConfirmRemove?b(this).parents(a.rowWrapTag).fadeOut(a.speedFadeOutLI,function(){b(this).remove();cacheLastLI=e()}):a.cbConfirmRemove(b(this),a)&&b(this).parents(a.rowWrapTag).fadeOut(a.speedFadeOutLI,function(){b(this).remove();cacheLastLI=e()});a.cbRemovePost&&a.cbRemovePost(b(this),a);return!1});b(a.initElement).find(a.selectorMoveUp).on("click",function(){if(!0==a.boolMove){if(!0!=c(this))return!1;a.cbUpPre&&a.cbUpPre(b(this),a);if(!0!= c(b(this).parents(a.rowWrapTag).prev(a.rowWrapTag).find(a.selectorMoveDown)))return!1;thisLI=b(this).parents(a.rowWrapTag);thisLI.index()>=a.intMinRows&&(thisLI.prev(a.rowWrapTag).before(thisLI),cacheLastLI=e());a.cbUpPost&&a.cbUpPost(b(this),a)}});b(a.initElement).find(a.selectorMoveDown).on("click",function(){if(!0==a.boolMove){if(!0!=c(this))return!1;a.cbDownPre&&a.cbDownPre(b(this),a);if(!0!=c(b(this).parents(a.rowWrapTag).next(a.rowWrapTag).find(a.selectorMoveDown)))return!1;!0==a.boolMove&& (thisLI=b(this).parents(a.rowWrapTag),thisLI.next(a.rowWrapTag).after(thisLI),cacheLastLI=e());a.cbDownPost&&a.cbDownPost(b(this),a)}});b(a.initElement).find(a.selectorSubmitClass).on("click",function(){a.boolSubmit&&b(a.initElement).find(a.selectorParentUL+" :input").removeAttr("disabled")})};b.fn.ezDynamicList.defaults={rowWrapTag:"li",boolAddCurrentClone:!1,arrAddCurrentReset:{},selectorWrapDefaultLI:".stash-default-li",selectorParentUL:".parent-ul",boolAutoAddOnLoad:!0,boolConfirmRemove:!0,cbConfirmRemove:function(a, b){return confirm(b.strConfirmRemoveMsg)},strConfirmRemoveMsg:"Delete this? Are you sure?",boolSubmit:!0,selectorSubmitClass:".submit",boolMove:!0,selectorMoveUp:".swap-up",selectorMoveDown:".swap-down",selectorAddClass:".action-row-add",selectorRemoveClass:".action-row-delete",selectorEditClass:".action-row-edit",speedFadeInLI:300,speedFadeOutLI:150,intMinRows:2,intMaxRows:6,boolMessageMaxRowsDefault:!1,selectorMaxRowsClass:".max-row-msg",classMessageMaxRowsAlert:"max-row-msg-alert",arrRequiredToAction:{}, cbRefreshPre:"",cbRefreshPost:"",cbAddPre:"",cbAddPost:"",cbRemovePre:"",cbRemovePost:"",cbEditPre:"",cbEditPost:"",cbUpPre:"",cbUpPost:"",cbDownPre:"",cbDownPost:""}})(jQuery);